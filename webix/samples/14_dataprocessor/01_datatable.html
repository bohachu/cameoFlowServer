<!DOCTYPE html>
<html>
<head>
    <title>Server-side Integration: Datatable</title>
    <link charset="utf-8" href="../../codebase/webix.css?v=7.0.1" rel="stylesheet" type="text/css">
    <script charset="utf-8" src="../../codebase/webix.js?v=7.0.1" type="text/javascript"></script>

    <link href="../common/samples.css?v=7.0.1" rel="stylesheet" type="text/css">
    <script charset="utf-8" src="../common/testdata.js?v=7.0.1" type="text/javascript"></script>
</head>
<body>
<div class='header_comment'>Server-side Integration for Datatable</div>
<div class='sample_comment'>The sample shows the use of dataProcessor for 'communication' with server-side.</div>

<div id="testA" style="padding: 20px;"></div>
<hr>
<div style="padding: 20px;">
    <input id="value" style='width:300px' type="text" value="new value"/>
    <input onclick="update()" type="button" value="update selected"/><br>
    <input onclick="add()" style='width:180px' type="button" value="add new row"/>
    <input onclick="remove_row()" style='width:180px' type="button" value="remove selected row"/>
</div>
<script charset="utf-8" type="text/javascript">
    var grid, dp;
    webix.ready(function () {
        grid = webix.ui({
            container: "testA",
            view: "datatable",
            columns: [
                {id: "rank", header: "#", width: 50, css: "rank"},
                {id: "title", header: "Film title", width: 200},
                {id: "year", header: "Released", width: 80},
                {id: "votes", header: "Votes", width: 100}
            ],
            select: "cell",
            autowidth: true,
            autoheight: true,
            on: {
                "onAfterSelect": function (id) {
                    document.getElementById("value").value = this.getItem(id.row)[id.column];
                }
            }
        });
        grid.load("/samples/server/films");
        dp = new webix.DataProcessor({
            url: "rest->/samples/server/films",
            master: grid
        });

    });

    function update() {
        if (!grid) return;

        var sel = grid.getSelectedId();
        if (!sel) return;

        var value = document.getElementById("value").value;
        var row = grid.getItem(sel.row);
        row[sel.column] = value;
        grid.updateItem(sel.row, row);
    }

    function add() {
        if (!grid) return;

        var data = {
            title: "",
            year: "1998",
            votes: 194865,
            rating: "7.5",
            rank: 12
        };
        grid.add(data);
    }

    function remove_row() {
        if (!grid) return;

        var sel = grid.getSelectedId(true);
        if (!sel) return;
        for (var i = 0; i < sel.length; i++)
            grid.remove(sel[i].row);
    }
</script>
</body>
</html>