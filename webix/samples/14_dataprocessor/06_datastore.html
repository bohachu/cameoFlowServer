<!DOCTYPE html>
<html>
<head>
    <script charset="utf-8" src="../../codebase/webix.js?v=7.0.1" type="text/javascript"></script>
    <link charset="utf-8" href="../../codebase/webix.css?v=7.0.1" rel="stylesheet" type="text/css">
    <title>Data Syncing with DataCollection</title>
</head>
<body>
<div class='header_comment'>Server-side Integration</div>
<div class='sample_comment'>The sample shows the use of dataProcessor for 'communication' with server-side.</div>

<div id="mylist" style="width: 400px; height: 300px;padding: 20px;"></div>
<div style="padding: 20px;">
    <input id="value" style='width:300px' type="text" value="new value"/>
    <input onclick="update_item()" type="button" value="update selected"/><br>
    <input onclick="add_item()" style='width:148px' type="button" value="add new item"/>
    <input onclick="remove_item()" style='width:148px' type="button" value="remove selected item"/>
</div>
<script charset="utf-8" type="text/javascript">

    var store;

    function add_item() {
        var data = {
            title: "New film",
            year: "1998",
            votes: 194865,
            rating: "7.5",
            rank: store.count() + 1
        };
        store.add(data);
    };

    function remove_item() {
        var sel = $$('mylist').getSelectedId(true);
        if (!sel) return;
        for (var i = 0; i < sel.length; i++)
            store.remove(sel[i]);
    };

    function update_item() {
        var sel = $$('mylist').getSelectedId(true);
        if (!sel) return;

        var value = document.getElementById("value").value;
        for (var i = 0; i < sel.length; i++) {
            var item = store.getItem(sel[i]);
            item.title = value;
            store.updateItem(sel[i]);
        }
    }

    webix.ready(function () {
        store = new webix.DataCollection({
            url: "/samples/server/films"
        });
        var list = webix.ui({
            container: "mylist",
            view: "list",
            id: "mylist",
            type: {
                width: "auto",
                template: "#rank#. #title# (#rating#)"
            },
            select: "multiselect"
        });
        list.sync(store);

        $$('mylist').attachEvent("onAfterSelect", function (id) {
            var value = store.getItem(id).title;
            document.getElementById("value").value = value;
        });

        var dp = new webix.DataProcessor({
            master: store,
            url: "rest->/samples/server/films"
        });
    });
</script>
</body>
</html>