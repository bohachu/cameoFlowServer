<!DOCTYPE html>
<html>
<head>
    <script charset="utf-8" src="../../codebase/webix.js?v=7.0.1" type="text/javascript"></script>
    <link charset="utf-8" href="../../codebase/webix.css?v=7.0.1" rel="stylesheet" type="text/css">
    <title>Server-side Integration: Dataview</title>
</head>
<body>
<div class='header_comment'>Server-side Integration</div>
<div class='sample_comment'>The sample shows the use of dataProcessor for 'communication' with server-side.</div>

<div id="dataA" style="width: 400px; height: 300px;padding: 20px;"></div>
<div style="padding: 20px;">
    <input id="value" style='width:300px' type="text" value="new value"/>
    <input onclick="update_item()" type="button" value="update selected"/><br>
    <input onclick="add_item()" style='width:148px' type="button" value="add new item"/>
    <input onclick="remove_item()" style='width:148px' type="button" value="remove selected item"/>
</div>
<script charset="utf-8" type="text/javascript">

    function add_item() {
        var data = $$('data');
        var item = {
            title: "New film",
            year: "1998",
            votes: 194865,
            rating: "7.5",
            rank: data.count() + 1
        };
        data.add(item);
    };

    function remove_item() {
        var data = $$('data');
        var sel = data.getSelectedId(true);
        if (!sel) return;
        for (var i = 0; i < sel.length; i++)
            data.remove(sel[i]);
    };

    function update_item() {
        var data = $$('data');
        var sel = data.getSelectedId(true);
        if (!sel) return;

        var value = document.getElementById("value").value;
        for (var i = 0; i < sel.length; i++) {
            var item = data.getItem(sel[i]);
            item.title = value;
            data.updateItem(sel[i], item);
        }
    }

    webix.ready(function () {
        webix.ui({
            id: "data",
            view: "dataview",
            container: "dataA",
            template: "<div class='webix_strong'>#title#</div> Year: #year#, rank: #rank#",
            select: "multiselect",
            url: "/samples/server/films"
        });

        $$('data').attachEvent("onAfterSelect", function (id) {
            var value = this.getItem(id).title;
            document.getElementById("value").value = value;
        });

        var dp = new webix.DataProcessor({
            master: $$('data'),
            url: "rest->/samples/server/films"
        });
    });
</script>
</body>
</html>