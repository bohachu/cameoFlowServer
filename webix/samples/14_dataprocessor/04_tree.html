<!DOCTYPE html>
<html>
<head>
    <script charset="utf-8" src="../../codebase/webix.js?v=7.0.1" type="text/javascript"></script>
    <link charset="utf-8" href="../../codebase/webix.css?v=7.0.1" rel="stylesheet" type="text/css">
    <title>Server-side Integration: Tree</title>
</head>
<body>
<div class='header_comment'>Server-side Integration</div>
<div class='sample_comment'>The sample shows the use of dataProcessor for 'communication' with server-side.</div>

<div id="treeA" style="width: 400px; height: 300px;padding: 20px;"></div>
<div style="padding: 20px;">
    <input id="value" style='width:300px' type="text" value="new value"/>
    <input onclick="update_item()" type="button" value="update selected"/><br>
    <input onclick="add_item()" style='width:148px' type="button" value="add new item"/>
    <input onclick="remove_item()" style='width:148px' type="button" value="remove selected item"/>
</div>
<script charset="utf-8" type="text/javascript">

    var tree;

    function add_item() {
        var item = {title: "New film"};
        tree.add(item, null, tree.getSelectedId() || 0);
    };

    function remove_item() {
        var sel = tree.getSelectedId(true);
        if (!sel) return;
        for (var i = 0; i < sel.length; i++)
            tree.remove(sel[i]);
    };

    function update_item() {
        var sel = tree.getSelectedId(true);
        if (!sel) return;

        var value = document.getElementById("value").value;
        for (var i = 0; i < sel.length; i++) {
            var item = tree.getItem(sel[i]);
            item.title = value;
            tree.updateItem(sel[i], item);
        }
    }

    webix.ready(function () {
        var myxml = webix.DataDriver.myxml = webix.copy(webix.DataDriver.xml);
        myxml.records = "/*/book";
        myxml.child = "part";

        //inline xml, custom tags
        tree = webix.ui({
            container: "treeA",
            view: "tree",
            url: "/samples/server/pages",
            template: "{common.icon()} #title#",
            select: true,
            drag: true
        });

        tree.attachEvent("onItemClick", function (id) {
            var title = this.getItem(id).title;
            document.getElementById("value").value = title;
        });


        var dp = new webix.DataProcessor({
            master: tree,
            url: "rest->/samples/server/pages",
            trackMove: true
        });
    });
</script>
</body>
</html>