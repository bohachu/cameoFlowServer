<!DOCTYPE html>
<html>
<head>
    <title>Tree Data Binding</title>
    <link charset="utf-8" href="../../../codebase/webix.css?v=7.0.1" rel="stylesheet" type="text/css">
    <script charset="utf-8" src="../../../codebase/webix.js?v=7.0.1" type="text/javascript"></script>
    <script charset="utf-8" src="../common/treedata.js?v=7.0.1" type="text/javascript"></script>
    <link href="../common/samples.css?v=7.0.1" rel="stylesheet" type="text/css">
</head>
<body>
<div class='header_comment'>Data binding</div>

<input onClick="addToTop()" type="button" value="Add to top"/>
<input onClick="addToParent()" type="button" value="Add to selected parent"/>
<input onClick="addAsChild()" type="button" value="Add as 2nd child of Shawshank Redemption"/>
<input onClick="removeSelected()" type="button" value="Remove selected node"/>

<script charset="utf-8" type="text/javascript">

    var tree1 = {
        view: "tree",
        id: "tree",
        filterMode: {showSubItems: false},
        select: true,
        template: "{common.icon()} {common.folder()} <span>#value#</span>",
        data: smalltreedata
    };

    var tree2 = {
        view: "form",
        id: "form",
        elements: [
            {view: "text", name: "value"},
            {
                view: "button", value: "Save", click: function () {
                    this.getFormView().save();
                }
            },
            {}
        ]
    };

    var grid1 = {
        view: "datatable",
        id: "grid",
        columns: [
            {id: "id"},
            {id: "value", fillspace: 1, editor: "text"}
        ], editable: true,
        on: {
            onAfterEditStop: function (state, editor) {
                $$("tree").updateItem(editor.row, this.getItem(editor.row));
            }
        }
    };

    webix.ui({
        cols: [
            {header: "Master Tree", body: tree1},
            {header: "Linked Grid", body: grid1},
            {header: "Linked Tree", body: tree2}
        ]
    })

    $$("tree").filter(function (obj) {
        return !!obj.$count;
    });
    $$("grid").bind($$("tree"), "$level");
    $$("form").bind($$("tree"));

    function addToTop() {
        $$("tree").add({value: "New item"}, 0);
    }

    function addToParent() {
        var parentId = $$("tree").getSelectedId();
        if (parentId)
            $$("tree").add({value: "New item"}, 0, parentId);
        else
            webix.alert("Select node")
    }

    function addAsChild() {
        $$("tree").select("1");
        var parentId = $$("tree").getSelectedId();
        var pos = $$("tree").getBranchIndex("1.2"); //'1.2' is the 'Part2' item's id
        $$("tree").add({value: "New item"}, pos, parentId);
    }

    function removeSelected() {
        var nodeId = $$("tree").getSelectedId();
        $$("tree").remove(nodeId);
    }


</script>
</body>
</html>